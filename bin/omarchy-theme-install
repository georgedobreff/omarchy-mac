#!/bin/bash

if [ -z "$1" ]; then
  echo -e "\e[32mSee https://manuals.omamix.org/2/the-omarchy-manual/90/extra-themes\n\e[0m"
  REPO_URL=$(gum input --placeholder="Git repo URL for theme" --header="")
else
  REPO_URL="$1"
fi

if [ -z "$REPO_URL" ]; then
  exit 1
fi

THEMES_DIR="$HOME/.config/omarchy/themes"
THEME_NAME=$(basename "$REPO_URL" .git | sed -E 's/^omarchy-//; s/-theme$//')
THEME_PATH="$THEMES_DIR/$THEME_NAME"

if [ -d "$THEME_PATH" ]; then
  rm -rf "$THEME_PATH"
fi

if ! git clone "$REPO_URL" "$THEME_PATH"; then
  echo "Error: Failed to clone theme repo."
  exit 1
fi

if [[ -f "$THEME_PATH/walker.css" && ! -f "$THEME_PATH/fuzzel.ini" ]]; then
  echo "Auto-generating fuzzel.ini for new theme..."
  omarchy-mac-custom-theme-utility
fi

omarchy-theme-set $THEME_NAME
